<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>잘어울리개 동의서</title>

<style>
body{font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;margin:0;background:#f6f7fb;color:#111}
.wrap{max-width:860px;margin:0 auto;padding:16px}
.card{background:#fff;border-radius:14px;padding:16px;margin:12px 0;box-shadow:0 1px 4px rgba(0,0,0,.05)}
label{display:block;font-size:13px;margin-top:10px}
input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #ddd;margin-top:4px}
textarea{min-height:80px}
.row{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:600px){.row.two{grid-template-columns:1fr 1fr}}
canvas{width:100%;height:180px;border:1px dashed #ccc;border-radius:12px}
button{padding:12px 14px;border-radius:10px;border:none;font-weight:700;cursor:pointer}
.primary{background:#22c55e;color:#fff}
.status{margin-top:10px;font-weight:700}
.ok{color:#16a34a}
.bad{color:#b91c1c}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h2>잘어울리개 동의서</h2>
</div>

<div class="card">
<h3>예약 정보</h3>
<div class="row two">
<select id="service">
<option value="">서비스 선택</option>
<option>유치원</option>
<option>호텔</option>
<option>놀이방</option>
<option>유치원+호텔</option>
</select>
<select id="weight_band">
<option value="">몸무게</option>
<option>5kg미만</option>
<option>13kg미만</option>
<option>13kg이상</option>
</select>
</div>
<div class="row two">
<input id="start_dt" type="datetime-local">
<input id="end_dt" type="datetime-local">
</div>
</div>

<div class="card">
<h3>강아지</h3>
<input id="dog_name" placeholder="이름 *">
<input id="breed" placeholder="견종">
<input id="birth" placeholder="생년월일">
<select id="sex"><option value="">성별</option><option>암</option><option>수</option></select>
<select id="neutered"><option value="">중성화</option><option>예</option><option>아니오</option></select>
<input id="allergy" placeholder="알러지">
<input id="potty" placeholder="배변">
<input id="social" placeholder="사회성">
<textarea id="care_points" placeholder="케어 포인트"></textarea>
</div>

<div class="card">
<h3>보호자</h3>
<input id="guardian_phone" placeholder="보호자 연락처 *">
<input id="delegate_phone" placeholder="대리인 번호">
<input id="address" placeholder="주소 *">
<textarea id="notes" placeholder="특이사항"></textarea>
</div>

<div class="card">
<label><input type="checkbox" id="sns_consent" checked> SNS 업로드 동의</label>
<label><input type="checkbox" id="separation_request"> 분리 요청</label>
</div>

<div class="card">
<h3>서명</h3>
<canvas id="sig"></canvas>
<br>
<button id="clearSig">서명 지우기</button>
<button class="primary" id="submitBtn">제출(자동저장)</button>
<div id="status" class="status"></div>
</div>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyEaP9cvyCXisdyZo2SedV0LZUTnH_yTEBNHF0nS7Ww3mwfBn9cq9ftyrqt3UZ3Mxt0/exec";
const KAKAO_CHAT_URL = "https://open.kakao.com/o/sXUbi6ai";

const canvas=document.getElementById("sig");
const ctx=canvas.getContext("2d");
let drawing=false,hasStroke=false;

function resize(){
canvas.width=canvas.offsetWidth;
canvas.height=180;
ctx.lineWidth=3;
ctx.lineCap="round";
}
resize();
window.onresize=resize;

function pos(e){
const r=canvas.getBoundingClientRect();
const t=e.touches?e.touches[0]:e;
return{x:t.clientX-r.left,y:t.clientY-r.top};
}

canvas.onmousedown=e=>{drawing=true;hasStroke=true;let p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);}
canvas.onmousemove=e=>{if(!drawing)return;let p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke();}
window.onmouseup=()=>drawing=false;
canvas.ontouchstart=e=>{e.preventDefault();drawing=true;hasStroke=true;let p=pos(e);ctx.beginPath();ctx.moveTo(p.x,p.y);}
canvas.ontouchmove=e=>{e.preventDefault();if(!drawing)return;let p=pos(e);ctx.lineTo(p.x,p.y);ctx.stroke();}
canvas.ontouchend=()=>drawing=false;

clearSig.onclick=()=>{ctx.clearRect(0,0,canvas.width,canvas.height);hasStroke=false;}

function v(id){return document.getElementById(id).value.trim();}
function c(id){return document.getElementById(id).checked;}

submitBtn.onclick=async()=>{
const status=document.getElementById("status");
if(!v("dog_name")||!v("guardian_phone")||!v("address")){status.innerHTML="<span class='bad'>필수항목 누락</span>";return;}
if(!hasStroke){status.innerHTML="<span class='bad'>서명 필요</span>";return;}

const payload={
service:v("service"),weight_band:v("weight_band"),
start_dt:v("start_dt"),end_dt:v("end_dt"),
dog_name:v("dog_name"),breed:v("breed"),birth:v("birth"),
sex:v("sex"),neutered:v("neutered"),allergy:v("allergy"),
potty:v("potty"),social:v("social"),care_points:v("care_points"),
guardian_phone:v("guardian_phone"),delegate_phone:v("delegate_phone"),
address:v("address"),notes:v("notes"),
sns_consent:c("sns_consent"),separation_request:c("separation_request"),
signature_png_base64:canvas.toDataURL("image/png")
};

status.textContent="저장중...";
const res=await fetch(SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain"},body:JSON.stringify(payload)});
const data=await res.json();
if(!data.ok){status.innerHTML="<span class='bad'>저장 실패</span>";return;}

let msg=`잘어울리개 예약 완료\n이름:${payload.dog_name}\n전화:${payload.guardian_phone}\n주소:${payload.address}`;
await navigator.clipboard.writeText(msg);
window.open(KAKAO_CHAT_URL,"_blank");
status.innerHTML="<span class='ok'>저장 완료! 카톡으로 이동합니다</span>";
};
</script>

</body>
</html>
