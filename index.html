<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ì˜ì–´ìš¸ë¦¬ê°œ ë™ì˜ì„œ</title>
  <style>
    body{font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;margin:0;background:#f6f7fb;color:#111827}
    .wrap{max-width:860px;margin:0 auto;padding:16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:16px;margin:12px 0}
    label{display:block;font-size:12px;color:#6b7280;margin:10px 0 6px}
    input,select,textarea{width:100%;padding:12px;border:1px solid #e5e7eb;border-radius:12px;font-size:14px}
    textarea{min-height:90px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:640px){.row.two{grid-template-columns:1fr 1fr}}
    .sigbox{border:1px dashed #cbd5e1;border-radius:12px;overflow:hidden;background:#fafafa}
    canvas{width:100%;height:180px;touch-action:none}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    button{padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-weight:800;cursor:pointer}
    button.primary{background:#22c55e;border-color:#22c55e;color:#fff}
    .status{font-size:13px;margin-top:10px}
    .ok{color:#16a34a;font-weight:900}
    .bad{color:#b45309;font-weight:900}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2 style="margin:0 0 8px">ì˜ì–´ìš¸ë¦¬ê°œ ìœ ì¹˜ì› ë° í˜¸í…” ë™ì˜ì„œ</h2>
    <div style="color:#6b7280;font-size:13px;line-height:1.5">
      ì…ë ¥ í›„ ì œì¶œí•˜ë©´ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. (ì„œëª… í¬í•¨)
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">ì˜ˆì•½ ê¸°ë³¸ì •ë³´</h3>
    <div class="row two">
      <div>
        <label>ì„œë¹„ìŠ¤</label>
        <select id="service">
          <option value="">ì„ íƒ</option>
          <option>ìœ ì¹˜ì›</option>
          <option>í˜¸í…”</option>
          <option>ë†€ì´ë°©</option>
          <option>ìœ ì¹˜ì› + í˜¸í…”</option>
        </select>
      </div>
      <div>
        <label>ëª¸ë¬´ê²Œ êµ¬ê°„</label>
        <select id="weight_band">
          <option value="">ì„ íƒ</option>
          <option>5kgë¯¸ë§Œ</option>
          <option>13kgë¯¸ë§Œ</option>
          <option>13kgì´ìƒ(ë³„ë„ë¬¸ì˜)</option>
        </select>
      </div>
    </div>

    <div class="row two">
      <div>
        <label>ë§¡ê¸°ëŠ” ë‚ ì§œ/ì‹œê°„</label>
        <input id="start_dt" type="datetime-local">
      </div>
      <div>
        <label>ë°ë ¤ê°€ëŠ” ë‚ ì§œ/ì‹œê°„</label>
        <input id="end_dt" type="datetime-local">
      </div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">ê°•ì•„ì§€ ì •ë³´</h3>
    <div class="row two">
      <div><label>ì´ë¦„ *</label><input id="dog_name" placeholder="ì˜ˆ: ì†Œë‹ˆ"></div>
      <div><label>ê²¬ì¢…</label><input id="breed" placeholder="ì˜ˆ: í¬ë©”ë¼ë‹ˆì•ˆ"></div>
    </div>
    <div class="row two">
      <div><label>ìƒë…„ì›”ì¼</label><input id="birth" placeholder="ì˜ˆ: 2023-05-01"></div>
      <div><label>ì„±ë³„</label>
        <select id="sex"><option value="">ì„ íƒ</option><option>ì•”</option><option>ìˆ˜</option></select>
      </div>
    </div>
    <div class="row two">
      <div><label>ì¤‘ì„±í™” ì—¬ë¶€</label>
        <select id="neutered"><option value="">ì„ íƒ</option><option>ì˜ˆ</option><option>ì•„ë‹ˆì˜¤</option></select>
      </div>
      <div><label>ì•ŒëŸ¬ì§€ ìœ ë¬´</label><input id="allergy" placeholder="ì—†ìŒ / ë‹­ ì•ŒëŸ¬ì§€ ë“±"></div>
    </div>
    <label>ë°°ë³€(ë§ˆí‚¹) ìŠµê´€</label><input id="potty" placeholder="ì˜ˆ: ì‹¤ë‚´íŒ¨ë“œ / ì‹¤ì™¸ë§Œ / ë§ˆí‚¹ ìˆìŒ">
    <label>ì‚¬íšŒì„±</label><input id="social" placeholder="ì˜ˆ: ë‚¯ê°€ë¦¼ / í™œë°œ / ì†Œí˜•ê²¬ë§Œ ì¢‹ì•„í•¨">
    <label>ì¼€ì–´ í•„ìš”í•œ ë¶€ë¶„</label><textarea id="care_points" placeholder="ì˜ˆ: ë¶„ë¦¬ë¶ˆì•ˆ, ì§–ìŒ, ê³µê²©ì„±, ì•½ ë³µìš© ë“±"></textarea>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">ë³´í˜¸ì ì •ë³´</h3>
    <div class="row two">
      <div><label>íœ´ëŒ€í°ë²ˆí˜¸ *</label><input id="guardian_phone" placeholder="010-1234-5678"></div>
      <div><label>ëŒ€ë¦¬ì¸ë²ˆí˜¸(ì„ íƒ)</label><input id="delegate_phone" placeholder="010-0000-0000"></div>
      <label>ì£¼ì†Œ *</label>
<input id="address" placeholder="ì˜ˆ: ì¸ì²œ ì„œêµ¬ ì—¼ê³¡ë¡œ498ë²ˆì•ˆê¸¸ 16-1 (ìƒì„¸ì£¼ì†Œ í¬í•¨)">
    </div>
    <label>íŠ¹ì´ì‚¬í•­(ì„ íƒ)</label><textarea id="notes" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­"></textarea>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">ë™ì˜ í•­ëª©</h3>
    <label><input type="checkbox" id="sns_consent" checked> ì‚¬ì§„/ì˜ìƒ SNS ì—…ë¡œë“œì— ë™ì˜í•©ë‹ˆë‹¤ (í•´ì œ ê°€ëŠ¥)</label>
    <label><input type="checkbox" id="separation_request"> ë¶„ë¦¬ ìš”ì²­(í•„ìš” ì‹œ)</label>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">ì„œëª… *</h3>
    <div class="sigbox">
      <canvas id="sig"></canvas>
    </div>
    <div class="btns">
      <button type="button" id="clearSig">ì„œëª… ì§€ìš°ê¸°</button>
      <button type="button" class="primary" id="submitBtn">ì œì¶œ(ìë™ ì €ì¥)</button>
    </div>
    <div class="status" id="status"></div>
  </div>
</div>

<script>
  // âœ… ë„ˆê°€ ë³´ë‚¸ ì›¹ ì•± URL (ê·¸ëŒ€ë¡œ)
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyEaP9cvyCXisdyZo2SedV0LZUTnH_yTEBNHF0nS7Ww3mwfBn9cq9ftyrqt3UZ3Mxt0/exec";

  // --- Signature pad ---
  const canvas = document.getElementById("sig");
  const ctx = canvas.getContext("2d");
  let drawing = false, hasStroke = false;

  function resizeCanvas(){
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.floor(rect.width * dpr);
    canvas.height = Math.floor(180 * dpr);
    canvas.style.height = "180px";
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.lineWidth = 3;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#111827";
  }
  resizeCanvas();
  window.addEventListener("resize", () => location.reload());

  function pos(e){
    const r = canvas.getBoundingClientRect();
    const t = e.touches ? e.touches[0] : e;
    return { x: t.clientX - r.left, y: t.clientY - r.top };
  }
  function start(e){ drawing = true; hasStroke = true; const p = pos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); e.preventDefault(); }
  function move(e){ if(!drawing) return; const p = pos(e); ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); }
  function end(){ drawing = false; }

  canvas.addEventListener("mousedown", start);
  canvas.addEventListener("mousemove", move);
  window.addEventListener("mouseup", end);
  canvas.addEventListener("touchstart", start, {passive:false});
  canvas.addEventListener("touchmove", move, {passive:false});
  canvas.addEventListener("touchend", end);

  document.getElementById("clearSig").onclick = () => {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    hasStroke = false;
    document.getElementById("status").innerHTML = `<span class="bad">ì„œëª…ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤.</span>`;
  };

  function v(id){ return document.getElementById(id).value.trim(); }
  function c(id){ return document.getElementById(id).checked; }

  document.getElementById("submitBtn").onclick = async () => {
    const status = document.getElementById("status");

    if(!v("dog_name") || !v("guardian_phone") || !v("address")){
  status.innerHTML = `<span class="bad">ê°•ì•„ì§€ ì´ë¦„ / ë³´í˜¸ì ë²ˆí˜¸ / ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</span>`;
  return;
    }
    if(!hasStroke){
      status.innerHTML = `<span class="bad">ì„œëª… í›„ ì œì¶œí•´ì£¼ì„¸ìš”.</span>`;
      return;
    }

    const signature = canvas.toDataURL("image/png");

    const payload = {
      service: v("service"),
      weight_band: v("weight_band"),
      start_dt: v("start_dt") ? v("start_dt").replace("T"," ") : "",
      end_dt: v("end_dt") ? v("end_dt").replace("T"," ") : "",
      dog_name: v("dog_name"),
      breed: v("breed"),
      birth: v("birth"),
      sex: v("sex"),
      neutered: v("neutered"),
      allergy: v("allergy"),
      potty: v("potty"),
      social: v("social"),
      care_points: v("care_points"),
      guardian_phone: v("guardian_phone"),
      delegate_phone: v("delegate_phone"),
      notes: v("notes"),
      sns_consent: c("sns_consent"),
      separation_request: c("separation_request"),
      signature_png_base64: signature,
      address: v("address"),

    };

    try{
      status.textContent = "ì €ì¥ ì¤‘...";
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if(!data.ok) throw new Error(data.message || "ì €ì¥ ì‹¤íŒ¨");

      status.innerHTML = `<span class="ok">ì €ì¥ ì™„ë£Œ!</span> ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ™‚`;
    }catch(e){
      status.innerHTML = `<span class="bad">ì˜¤ë¥˜:</span> ${e.message}`;
    }
  };
</script>
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyEaP9cvyCXisdyZo2SedV0LZUTnH_yTEBNHF0nS7Ww3mwfBn9cq9ftyrqt3UZ3Mxt0/exec";

  // âœ… ì—¬ê¸°ë§Œ ë„ˆ ë§í¬ë¡œ ë°”ê¿”
  const KAKAO_CHAT_URL = "https://open.kakao.com/o/sXUbi6ai"; // ì±„ë„ 1:1 ì±„íŒ… ë§í¬

  function buildKakaoMessage(p, saved){
    // saved.signature_file_url ìˆìœ¼ë©´ ê°™ì´ ë„£ê¸°
    const sig = saved?.signature_file_url ? `\nì„œëª…íŒŒì¼: ${saved.signature_file_url}` : "";
    return `ì•ˆë…•í•˜ì„¸ìš”! ì˜ì–´ìš¸ë¦¬ê°œì…ë‹ˆë‹¤ ğŸ˜Š
ë™ì˜ì„œ/ì˜ˆì•½ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.

[ì˜ˆì•½]
- ì„œë¹„ìŠ¤: ${p.service || "-"}
- ëª¸ë¬´ê²Œ: ${p.weight_band || "-"}
- ë§¡ê¸°ëŠ” ë‚ ì§œ/ì‹œê°„: ${p.start_dt || "-"}
- ë°ë ¤ê°€ëŠ” ë‚ ì§œ/ì‹œê°„: ${p.end_dt || "-"}

[ê°•ì•„ì§€]
- ì´ë¦„: ${p.dog_name || "-"}
- ê²¬ì¢…: ${p.breed || "-"}
- ìƒë…„ì›”ì¼: ${p.birth || "-"}
- ì„±ë³„: ${p.sex || "-"}
- ì¤‘ì„±í™”: ${p.neutered || "-"}
- ì•ŒëŸ¬ì§€: ${p.allergy || "-"}
- ë°°ë³€/ë§ˆí‚¹: ${p.potty || "-"}
- ì‚¬íšŒì„±: ${p.social || "-"}
- ì¼€ì–´ í¬ì¸íŠ¸: ${p.care_points || "-"}

[ë³´í˜¸ì]
- ì—°ë½ì²˜: ${p.guardian_phone || "-"}
- ëŒ€ë¦¬ì¸: ${p.delegate_phone || "-"}
- ì£¼ì†Œ: ${p.address || "-"}

[ë™ì˜]
- SNS ì—…ë¡œë“œ ë™ì˜: ${p.sns_consent ? "ë™ì˜" : "ë¯¸ë™ì˜"}
- ë¶„ë¦¬ ìš”ì²­: ${p.separation_request ? "ìš”ì²­" : "ì—†ìŒ"}

íŠ¹ì´ì‚¬í•­: ${p.notes || "-"}` + sig;
  }

  async function copyToClipboard(text){
    try{
      await navigator.clipboard.writeText(text);
      return true;
    }catch(e){
      // êµ¬í˜• ë¸Œë¼ìš°ì € fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      const ok = document.execCommand("copy");
      document.body.removeChild(ta);
      return ok;
    }
  }

  // ... (ê¸°ì¡´ ì½”ë“œ ê·¸ëŒ€ë¡œ)

  document.getElementById("submitBtn").onclick = async () => {
    const status = document.getElementById("status");

    if(!v("dog_name") || !v("guardian_phone") || !v("address")){
      status.innerHTML = `<span class="bad">ê°•ì•„ì§€ ì´ë¦„ / ë³´í˜¸ì ë²ˆí˜¸ / ì£¼ì†ŒëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.</span>`;
      return;
    }
    if(!hasStroke){
      status.innerHTML = `<span class="bad">ì„œëª… í›„ ì œì¶œí•´ì£¼ì„¸ìš”.</span>`;
      return;
    }

    const signature = canvas.toDataURL("image/png");

    const payload = {
      service: v("service"),
      weight_band: v("weight_band"),
      start_dt: v("start_dt") ? v("start_dt").replace("T"," ") : "",
      end_dt: v("end_dt") ? v("end_dt").replace("T"," ") : "",
      dog_name: v("dog_name"),
      breed: v("breed"),
      birth: v("birth"),
      sex: v("sex"),
      neutered: v("neutered"),
      allergy: v("allergy"),
      potty: v("potty"),
      social: v("social"),
      care_points: v("care_points"),
      guardian_phone: v("guardian_phone"),
      delegate_phone: v("delegate_phone"),
      address: v("address"),
      notes: v("notes"),
      sns_consent: c("sns_consent"),
      separation_request: c("separation_request"),
      signature_png_base64: signature
    };

    try{
      status.textContent = "ì €ì¥ ì¤‘...";
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers:{ "Content-Type":"text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      const data = await res.json();
      if(!data.ok) throw new Error(data.message || "ì €ì¥ ì‹¤íŒ¨");

      // âœ… ì•ˆë‚´ë¬¸ ìë™ ìƒì„± + ë³µì‚¬ + ì¹´í†¡ ì´ë™
      const msg = buildKakaoMessage(payload, data);
      const copied = await copyToClipboard(msg);

      status.innerHTML =
        `<span class="ok">ì €ì¥ ì™„ë£Œ!</span> ` +
        (copied ? `ì•ˆë‚´ë¬¸ì´ ë³µì‚¬ëì–´ìš”. ì¹´í†¡ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤ ğŸ™‚` : `ì €ì¥ ì™„ë£Œ! ì•„ë˜ ë²„íŠ¼ìœ¼ë¡œ ì¹´í†¡ ì´ë™ í›„ ë¶™ì—¬ë„£ê¸° í•´ì£¼ì„¸ìš” ğŸ™‚`) +
        `<div style="margin-top:10px;">
          <a href="${KAKAO_CHAT_URL}" target="_blank" style="display:inline-block;padding:12px 14px;border-radius:12px;background:#22c55e;color:#fff;font-weight:900;text-decoration:none;">
            ì¹´í†¡(ì±„ë„/ì˜¤í”ˆì±„íŒ…)ìœ¼ë¡œ ì´ë™
          </a>
        </div>`;

      // ë³µì‚¬ê°€ ëìœ¼ë©´ ìë™ ì´ë™(ìƒˆ íƒ­)
      if(copied){
        window.open(KAKAO_CHAT_URL, "_blank");
      }

    }catch(e){
      status.innerHTML = `<span class="bad">ì˜¤ë¥˜:</span> ${e.message}`;
    }
  };
</script>
</body>
</html>



