<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>잘어울리개 동의서</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui;margin:0;background:#f6f7fb}
.wrap{max-width:900px;margin:auto;padding:16px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:14px;border:1px solid #e5e7eb}
label{display:block;margin-top:10px;font-size:13px;color:#374151}
input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #e5e7eb;font-size:14px}
textarea{min-height:80px}
button{padding:12px 16px;border-radius:12px;border:none;font-weight:800}
.green{background:#22c55e;color:white}
.sigbox{border:1px dashed #94a3b8;border-radius:12px}
canvas{width:100%;height:180px}
.status{margin-top:12px;font-size:14px;font-weight:800}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h2>잘어울리개 유치원 & 호텔 동의서</h2>
</div>

<div class="card">
<label>서비스</label>
<select id="service"><option>유치원</option><option>호텔</option><option>놀이방</option></select>

<label>몸무게</label>
<select id="weight_band"><option>5kg미만</option><option>13kg미만</option><option>13kg이상</option></select>

<label>맡기는 날짜</label><input id="start_dt" type="datetime-local">
<label>데려가는 날짜</label><input id="end_dt" type="datetime-local">
</div>

<div class="card">
<h3>강아지</h3>
<input id="dog_name" placeholder="이름">
<input id="breed" placeholder="견종">
<input id="birth" placeholder="생년월일">
<select id="sex"><option>암</option><option>수</option></select>
<select id="neutered"><option>예</option><option>아니오</option></select>
<input id="allergy" placeholder="알러지">
<input id="potty" placeholder="배변">
<input id="social" placeholder="사회성">
<textarea id="care_points" placeholder="특이사항"></textarea>
</div>

<div class="card">
<h3>보호자</h3>
<input id="guardian_phone" placeholder="휴대폰번호">
<input id="delegate_phone" placeholder="대리인 번호">
<input id="address" placeholder="주소">
<textarea id="notes" placeholder="기타 요청"></textarea>
</div>

<div class="card">
<label><input type="checkbox" id="sns_consent" checked> SNS 동의</label>
<label><input type="checkbox" id="separation_request"> 분리 요청</label>
</div>

<div class="card">
<h3>서명</h3>
<div class="sigbox"><canvas id="sig"></canvas></div>
<button onclick="clearSig()">서명 지우기</button>
<button class="green" id="submitBtn">제출(자동 저장)</button>
<div class="status" id="status"></div>
</div>

</div>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbyEaP9cvyCXisdyZo2SedV0LZUTnH_yTEBNHF0nS7Ww3mwfBn9cq9ftyrqt3UZ3Mxt0/exec";
const KAKAO_CHAT_URL="https://open.kakao.com/o/sXUbi6ai";

const canvas=document.getElementById("sig");
const ctx=canvas.getContext("2d");
let draw=false,hasSig=false;

canvas.width=window.innerWidth*0.9;
canvas.height=180;
ctx.lineWidth=3;ctx.lineCap="round";

canvas.onmousedown=e=>{draw=true;hasSig=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);}
canvas.onmousemove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();}}
window.onmouseup=()=>draw=false;

function clearSig(){ctx.clearRect(0,0,canvas.width,canvas.height);hasSig=false;}

function v(id){return document.getElementById(id).value;}

document.getElementById("submitBtn").onclick=async()=>{
if(!v("dog_name")||!v("guardian_phone")||!v("address")||!hasSig){alert("필수 입력");return;}

const payload={
service:v("service"),weight_band:v("weight_band"),
start_dt:v("start_dt"),end_dt:v("end_dt"),
dog_name:v("dog_name"),breed:v("breed"),birth:v("birth"),
sex:v("sex"),neutered:v("neutered"),allergy:v("allergy"),
potty:v("potty"),social:v("social"),care_points:v("care_points"),
guardian_phone:v("guardian_phone"),delegate_phone:v("delegate_phone"),
address:v("address"),notes:v("notes"),
sns_consent:document.getElementById("sns_consent").checked,
separation_request:document.getElementById("separation_request").checked,
signature_png_base64:canvas.toDataURL("image/png")
};

const res=await fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify(payload)});
const data=await res.json();
if(!data.ok){alert("저장 실패");return;}

const msg=`잘어울리개 예약 완료\n이름:${payload.dog_name}\n전화:${payload.guardian_phone}\n주소:${payload.address}`;
navigator.clipboard.writeText(msg);

document.getElementById("status").innerHTML=`
저장 완료!<br>
<a href="${KAKAO_CHAT_URL}" target="_blank" style="background:#22c55e;color:white;padding:12px 16px;border-radius:12px;display:inline-block;margin-top:10px">카톡으로 이동</a>
`;
}
</script>
</body>
</html>
